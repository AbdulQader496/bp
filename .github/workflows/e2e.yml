name: Build and Run .NET 9 App

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-run:
    runs-on: windows-latest

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4

    - name: Setup .NET 9
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x

    # Restore Dependencies
    - name: Restore
      run: dotnet restore ./BPCalculator/BPCalculator.csproj

    # Build the project
    - name: Build
      run: dotnet build ./BPCalculator/BPCalculator.csproj --configuration Release

    # Run the API on localhost:5000
    - name: Start API
      shell: pwsh
      run: |
        Write-Host "Starting API on port 5000..."
        Start-Process -FilePath "dotnet" -ArgumentList "run --project ./BPCalculator/BPCalculator.csproj --urls=http://localhost:5000" -WindowStyle Hidden
        Start-Sleep -Seconds 10

    # Verify the API is running
    - name: Check API
      shell: pwsh
      run: |
        Write-Host "Checking API at http://localhost:5000 ..."
        try {
            $response = Invoke-WebRequest -Uri "http://localhost:5000" -UseBasicParsing
            Write-Host "API responded successfully!"
            Write-Host $response.StatusCode
        }
        catch {
            Write-Host "API did NOT start!"
            Write-Host $_
            exit 1
        }








# name: E2E Selenium Tests

# on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]

# jobs:
#   e2e-tests:
#     runs-on: windows-latest

#     steps:
#     # Checkout API repo (default)
#     - name: Checkout API Repo
#       uses: actions/checkout@v4

#     # Checkout Selenium Test Repo
#     - name: Checkout Selenium Tests Repo
#       uses: actions/checkout@v4
#       with:
#         repository: AbdulQader496/bpTestSelenium
#         path: selenium-tests

#     # Install JDK
#     - name: Set up JDK 21
#       uses: actions/setup-java@v4
#       with:
#         java-version: "21"
#         distribution: "temurin"

#     # Install Chrome via action
#     - name: Install Chrome
#       uses: browser-actions/setup-chrome@v1
#       with:
#         chrome-version: latest

#     # Install Chromedriver automatically matching Chrome version
#     - name: Install ChromeDriver
#       uses: nanasess/setup-chromedriver@v2

#     # Verify Chrome + Driver versions
#     - name: Verify browser setup
#       shell: pwsh
#       run: |
#         chrome --version
#         chromedriver --version

#     # Run Selenium Tests
#     - name: Run Maven Tests
#       shell: pwsh
#       working-directory: selenium-tests
#       run: mvn -e -X clean test -DskipTests=false
